<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìê TikZÂõ≥ÂΩ¢‰ΩúÊàê„Ç∑„Çπ„ÉÜ„É† v3.0 | Data Manager</title>
    <meta name="description" content="ÊïôËÇ≤ÁèæÂ†¥„Åß„ÅÆÊï∞Â≠¶„ÉªÂπæ‰ΩïÂ≠¶Âõ≥ÂΩ¢‰ΩúÊàê„Å´ÁâπÂåñ„Åó„ÅüTikZ Creator„ÄÇJSXGraphÁµ±Âêà„ÄÅ„Éá„Éê„ÉÉ„Ç∞Ê©üËÉΩÊê≠Ëºâ">
    <meta name="keywords" content="TikZ,Êï∞Â≠¶,Âπæ‰ΩïÂ≠¶,Âõ≥ÂΩ¢‰ΩúÊàê,ÊïôËÇ≤,JSXGraph">

    <!-- Open Graph -->
    <meta property="og:title" content="TikZÂõ≥ÂΩ¢‰ΩúÊàê„Ç∑„Çπ„ÉÜ„É† v3.0">
    <meta property="og:description" content="ÊïôËÇ≤ÁèæÂ†¥„Åß„ÅÆÂõ≥ÂΩ¢ÊïôÊùê‰ΩúÊàê„Å´ÁâπÂåñ„Åó„ÅüÂÆüÁî®ÁöÑ„Å™„ÉÑ„Éº„É´">
    <meta property="og:url" content="https://data.allfrom0.top/math/geo/">
    <meta property="og:type" content="website">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://data.allfrom0.top/math/geo/">

    <!-- JSXGraph for mathematical plotting -->
    <link rel="stylesheet" href="https://jsxgraph.uni-bayreuth.de/distrib/jsxgraph.css">
    <script src="https://jsxgraph.uni-bayreuth.de/distrib/jsxgraphcore.js"></script>

    <!-- CodeMirror for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css">

    <!-- IcoFont Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/icofont/1.0.1/icofont.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }

        .header-badge {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .breadcrumb {
            background: #f1f5f9;
            padding: 8px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .breadcrumb a {
            color: #3b82f6;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .panel-header {
            background: #e2e8f0;
            padding: 12px 16px;
            font-weight: 600;
            border-bottom: 1px solid #cbd5e1;
        }

        .panel-content {
            padding: 16px;
        }

        .input-area {
            height: 400px;
        }

        .CodeMirror {
            height: 100%;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }

        .CodeMirror-focused {
            border-color: #3b82f6;
        }

        .preview-area {
            height: 400px;
            overflow-y: auto;
            background: #fefefe;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .tikz-output {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            width: 100%;
            height: 300px;
            margin: 10px 0;
        }

        .tools-panel {
            grid-column: 1 / -1;
        }

        .mode-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 8px 16px;
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .mode-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .mode-btn:hover:not(.active) {
            background: #e2e8f0;
        }

        .toolbar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }

        .tool-btn {
            padding: 12px 8px;
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
        }

        .tool-btn:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }

        .tool-btn:active {
            background: #3b82f6;
            color: white;
            transform: translateY(0);
        }

        .color-tools {
            margin-bottom: 16px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
        }

        .color-btn {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            transition: all 0.2s;
        }

        .samples {
            margin-top: 16px;
        }

        .sample-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
        }

        .sample-btn {
            padding: 8px;
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            transition: all 0.2s;
        }

        .sample-btn:hover {
            background: #e0f2fe;
            transform: translateY(-1px);
        }

        .status {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            text-align: center;
        }

        .error {
            background: #fee2e2;
            border-color: #fca5a5;
            color: #991b1b;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #475569;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }

            .input-area,
            .preview-area {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- „Éë„É≥„Åè„Åö„Éä„Éì -->
        <div class="breadcrumb">
            <a href="https://data.allfrom0.top/">üè† Data Manager</a> &gt;
            <a href="https://data.allfrom0.top/math/">üìä Math</a> &gt;
            <span>üìê Geometry</span>
        </div>

        <header>
            <div class="header-badge">v3.0 JSXGraph</div>
            <h1><i class="icofont-ruler-compass-alt"></i> TikZÂõ≥ÂΩ¢‰ΩúÊàê„Ç∑„Çπ„ÉÜ„É† v3.0</h1>
            <p class="subtitle"><i class="icofont-chart-line"></i> JSXGraph + „É™„Ç¢„É´„Çø„Ç§„É†„É¨„É≥„ÉÄ„É™„É≥„Ç∞ + „Éá„Éê„ÉÉ„Ç∞Ê©üËÉΩÊê≠Ëºâ</p>
        </header>

        <div class="main-grid">
            <!-- ÂÖ•Âäõ„Ç®„É™„Ç¢ -->
            <div class="panel">
                <div class="panel-header"><i class="icofont-file-code"></i> TikZ„Ç≥„Éº„ÉâÂÖ•Âäõ</div>
                <div class="panel-content">
                    <div class="input-area">
                        <textarea id="tikzInput" placeholder="TikZ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...

‰æã:
\draw[->] (-2,0) -- (2,0) node[right] {x};
\draw[->] (0,-2) -- (0,2) node[above] {y};
\draw (0,0) circle (1);"></textarea>
                    </div>
                </div>
            </div>

            <!-- „Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢ -->
            <div class="panel">
                <div class="panel-header"><i class="icofont-eye-alt"></i> „Éó„É¨„Éì„É•„Éº</div>
                <div class="panel-content">
                    <div id="preview" class="preview-area">
                        <p style="color: #64748b; margin-top: 100px;">
                            TikZ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Âõ≥ÂΩ¢„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                        </p>

                        <!-- JSXGraph „ÉÜ„Çπ„ÉàÁî® -->
                        <div style="border: 1px solid #ccc; margin: 10px; padding: 10px; background: #f9f9f9;">
                            <h4 style="margin: 0 0 10px 0; color: #333;">JSXGraph „ÉÜ„Çπ„Éà:</h4>
                            <div id="test-board" class="tikz-output"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- „ÉÑ„Éº„É´„Éë„Éç„É´ -->
        <div class="panel tools-panel">
            <div class="panel-header"><i class="icofont-tools-alt-2"></i> Âõ≥ÂΩ¢‰ΩúÊàê„ÉÑ„Éº„É´</div>
            <div class="panel-content">
                <!-- „É¢„Éº„ÉâÈÅ∏Êäû -->
                <div class="section-title"><i class="icofont-chart-bar-graph"></i> ‰ΩúÊàê„É¢„Éº„Éâ</div>
                <div class="mode-buttons">
                    <button class="mode-btn active" data-mode="basic">Âü∫Êú¨Âõ≥ÂΩ¢</button>
                    <button class="mode-btn" data-mode="graph">„Ç∞„É©„Éï„ÉªÈñ¢Êï∞</button>
                    <button class="mode-btn" data-mode="geometry">Âπæ‰ΩïÂ≠¶</button>
                    <button class="mode-btn" data-mode="coordinate">Â∫ßÊ®ôÁ≥ª</button>
                </div>

                <!-- Â∫ßÊ®ôËª∏Ë®≠ÂÆö -->
                <div class="section-title"><i class="icofont-ruler-compass-alt"></i> Ë°®Á§∫Ë®≠ÂÆö</div>
                <div class="axis-controls" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                    <button class="mode-btn active" id="axisOn" style="font-size: 12px; padding: 6px 12px;">Â∫ßÊ®ôËª∏„ÅÇ„Çä</button>
                    <button class="mode-btn" id="axisOff" style="font-size: 12px; padding: 6px 12px;">Â∫ßÊ®ôËª∏„Å™„Åó</button>
                </div>

                <!-- „Ç®„Éá„Ç£„ÇøÂà∂Âæ° -->
                <div class="section-title"><i class="icofont-file-code"></i> „Ç®„Éá„Ç£„ÇøÂà∂Âæ°</div>
                <div class="editor-controls" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                    <button class="mode-btn" id="clearCode" style="font-size: 12px; padding: 6px 12px; background: #ef4444; color: white; border-color: #ef4444;"><i class="icofont-ui-delete"></i> „Ç≥„Éº„Éâ„ÇØ„É™„Ç¢</button>
                    <button class="mode-btn" id="exportPNG" style="font-size: 12px; padding: 6px 12px; background: #10b981; color: white; border-color: #10b981;"><i class="icofont-camera"></i> PNGÂá∫Âäõ</button>
                    <button class="mode-btn" id="exportSVG" style="font-size: 12px; padding: 6px 12px; background: #3b82f6; color: white; border-color: #3b82f6;"><i class="icofont-file-image"></i> SVGÂá∫Âäõ</button>
                </div>

                <!-- „ÉÑ„Éº„É´„Éê„Éº -->
                <div class="section-title"><i class="icofont-tools"></i> Âõ≥ÂΩ¢„ÉÑ„Éº„É´</div>
                <div id="toolbar" class="toolbar">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>

                <!-- „Çµ„É≥„Éó„É´ -->
                <div class="samples">
                    <div class="section-title"><i class="icofont-file-spreadsheet"></i> „ÉÜ„É≥„Éó„É¨„Éº„Éà</div>
                    <div class="sample-grid">
                        <button class="sample-btn" data-sample="Â∫ßÊ®ôÁ≥ª">Â∫ßÊ®ôÁ≥ª</button>
                        <button class="sample-btn" data-sample="‰∏âËßíÂΩ¢">‰∏âËßíÂΩ¢</button>
                        <button class="sample-btn" data-sample="ÂÜÜ">ÂÜÜ</button>
                        <button class="sample-btn" data-sample="‰∫åÊ¨°Èñ¢Êï∞">‰∫åÊ¨°Èñ¢Êï∞</button>
                        <button class="sample-btn" data-sample="Ê≠£Âº¶Ê≥¢">Ê≠£Âº¶Ê≥¢</button>
                        <button class="sample-btn" data-sample="‰∏âËßíÈñ¢Êï∞">‰∏âËßíÈñ¢Êï∞</button>
                        <button class="sample-btn" data-sample="„Éô„ÇØ„Éà„É´">„Éô„ÇØ„Éà„É´</button>
                        <button class="sample-btn" data-sample="ÂÜÜÂë®Ëßí">ÂÜÜÂë®Ëßí</button>
                        <button class="sample-btn" data-sample="Âπ≥Ë°åÁ∑ö">Âπ≥Ë°åÁ∑ö</button>
                        <button class="sample-btn" data-sample="ËßíÂ∫¶">ËßíÂ∫¶Ê∏¨ÂÆö</button>
                        <button class="sample-btn" data-sample="Áõ∏‰ºº">Áõ∏‰ººÂõ≥ÂΩ¢</button>
                        <button class="sample-btn" data-sample="Á¢∫Áéá">Á¢∫ÁéáÂàÜÂ∏É</button>
                    </div>
                </div>

                <!-- „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±„Éë„Éç„É´ -->
                <div class="info-panel" style="margin-top: 16px;">
                    <div class="section-title"><i class="icofont-info-circle"></i> „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±</div>
                    <div style="background: #f8fafc; padding: 12px; border-radius: 8px; font-size: 12px; color: #64748b;">
                        <div><i class="icofont-web"></i> Domain: <strong>data.allfrom0.top/math/geo</strong></div>
                        <div><i class="icofont-rocket-alt-1"></i> Version: <strong>v3.0 JSXGraph</strong></div>
                        <div><i class="icofont-flash"></i> Engine: <strong>JSXGraph + CodeMirror</strong></div>
                        <div><i class="icofont-chart-bar-graph"></i> Part of: <strong>Data Manager Education Suite</strong></div>
                    </div>
                </div>

                <!-- „Éá„Éê„ÉÉ„Ç∞„Ç≥„É≥„ÇΩ„Éº„É´ -->
                <div class="debug-panel" style="margin-top: 16px;">
                    <div class="section-title"><i class="icofont-bug"></i> „Éá„Éê„ÉÉ„Ç∞„Ç≥„É≥„ÇΩ„Éº„É´</div>
                    <div id="debugOutput" style="background: #1e1e1e; color: #fff; padding: 12px; border-radius: 8px; height: 120px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                        <div style="color: #4ade80;">TikZ Creator v3.0 ÂàùÊúüÂåñ‰∏≠...</div>
                    </div>
                </div>

                <!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div id="status" class="status">
                    JSXGraphË™≠„ÅøËæº„Åø‰∏≠...
                </div>
            </div>
        </div>
    </div>

    <!-- CodeMirror JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/stex/stex.min.js"></script>

    <script>
        // TikZÈ¢®ÊèèÁîª„Ç∑„Çπ„ÉÜ„É† v3.0 - JSXGraph‰ΩøÁî®
        class TikZCreatorV3 {
            constructor() {
                this.input = document.getElementById('tikzInput');
                this.preview = document.getElementById('preview');
                this.status = document.getElementById('status');
                this.toolbar = document.getElementById('toolbar');
                this.debugOutput = document.getElementById('debugOutput');
                this.currentMode = 'basic';
                this.editor = null;
                this.boardCounter = 0;
                this.showAxis = true;

                this.init();
            }

            init() {
                this.log('TikZ Creator v3.0 „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÈñãÂßã - data.allfrom0.top');
                this.log('JSXGraph„Éô„Éº„Çπ„ÅÆÊèèÁîª„Ç∑„Çπ„ÉÜ„É†„Å´Â§âÊõ¥');
                this.setupCodeEditor();
                this.setupEventListeners();
                this.setupModes();
                this.updateToolbar();
                this.initJSXGraph();
                this.log('Data Manager Education Suite „Å®Áµ±ÂêàÊ∫ñÂÇôÂÆå‰∫Ü');
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const colors = {
                    info: '#4ade80',
                    error: '#ef4444',
                    warn: '#f59e0b',
                    success: '#10b981'
                };

                const logEntry = document.createElement('div');
                logEntry.style.color = colors[type] || colors.info;
                logEntry.innerHTML = `[${timestamp}] [JSXGraph] ${message}`;

                this.debugOutput.appendChild(logEntry);
                this.debugOutput.scrollTop = this.debugOutput.scrollHeight;

                // 100Ë°å„ÇíË∂Ö„Åà„Åü„ÇâÂè§„ÅÑ„É≠„Ç∞„ÇíÂâäÈô§
                if (this.debugOutput.children.length > 100) {
                    this.debugOutput.removeChild(this.debugOutput.firstChild);
                }
            }

            initJSXGraph() {
                this.log('JSXGraphÂàùÊúüÂåñÈñãÂßã');
                try {
                    if (typeof JXG !== 'undefined') {
                        // „ÉÜ„Çπ„ÉàÁî®„Éú„Éº„Éâ‰ΩúÊàê
                        const testBoard = JXG.JSXGraph.initBoard('test-board', {
                            boundingbox: [-3, 3, 3, -3],
                            axis: this.showAxis,
                            showCopyright: false,
                            showNavigation: false
                        });

                        // „ÉÜ„Çπ„ÉàÁî®Âõ≥ÂΩ¢
                        const circle = testBoard.create('circle', [[0, 0], 1], {
                            strokeColor: 'blue',
                            strokeWidth: 2
                        });

                        testBoard.create('text', [0, -2, 'JSXGraph Test'], {
                            fontSize: 14,
                            color: 'red'
                        });

                        this.log('JSXGraphÂàùÊúüÂåñÂÆå‰∫Ü - „ÉÜ„Çπ„ÉàÂõ≥ÂΩ¢Ë°®Á§∫', 'success');
                        this.status.textContent = '‚úÖ JSXGraphÊ∫ñÂÇôÂÆå‰∫Ü - v3.0';
                        this.status.className = 'status';
                        this.loadSample();
                    } else {
                        this.log('JSXGraphÊú™Ë™≠„ÅøËæº„Åø', 'error');
                        this.status.textContent = '‚ùå JSXGraphË™≠„ÅøËæº„Åø„Ç®„É©„Éº';
                    }
                } catch (error) {
                    this.log('JSXGraphÂàùÊúüÂåñ„Ç®„É©„Éº: ' + error.message, 'error');
                }
            }

            setupCodeEditor() {
                this.log('CodeMirror„Ç®„Éá„Ç£„ÇøÂàùÊúüÂåñ');
                try {
                    this.editor = CodeMirror.fromTextArea(this.input, {
                        mode: 'stex',
                        theme: 'material-darker',
                        lineNumbers: true,
                        autoCloseBrackets: true,
                        matchBrackets: true,
                        indentUnit: 2,
                        tabSize: 2,
                        lineWrapping: true
                    });

                    this.editor.on('change', () => {
                        setTimeout(() => this.renderTikZ(), 500);
                    });

                    this.log('CodeMirror„Ç®„Éá„Ç£„ÇøÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
                } catch (error) {
                    this.log('„Ç®„Éá„Ç£„ÇøÂàùÊúüÂåñ„Ç®„É©„Éº: ' + error.message, 'error');
                    this.input.style.display = 'block';
                }
            }

            setupEventListeners() {
                // „Çµ„É≥„Éó„É´ÈÅ∏Êäû
                document.querySelectorAll('.sample-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.loadTemplate(btn.dataset.sample);
                        this.log(`„ÉÜ„É≥„Éó„É¨„Éº„ÉàË™≠„ÅøËæº„Åø: ${btn.dataset.sample}`);
                    });
                });

                // „É¢„Éº„ÉâÈÅ∏Êäû
                document.querySelectorAll('[data-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentMode = btn.dataset.mode;
                        this.updateToolbar();
                        this.log(`„É¢„Éº„ÉâÂ§âÊõ¥: ${btn.dataset.mode}`);
                    });
                });

                // Â∫ßÊ®ôËª∏Âà∂Âæ°
                document.getElementById('axisOn').addEventListener('click', () => {
                    document.querySelectorAll('.axis-controls .mode-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('axisOn').classList.add('active');
                    this.showAxis = true;
                    this.log('Â∫ßÊ®ôËª∏Ë°®Á§∫: ON');
                    this.renderTikZ();
                });

                document.getElementById('axisOff').addEventListener('click', () => {
                    document.querySelectorAll('.axis-controls .mode-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('axisOff').classList.add('active');
                    this.showAxis = false;
                    this.log('Â∫ßÊ®ôËª∏Ë°®Á§∫: OFF');
                    this.renderTikZ();
                });

                // „Ç®„Éá„Ç£„ÇøÂà∂Âæ°
                document.getElementById('clearCode').addEventListener('click', () => {
                    if (confirm('„Ç≥„Éº„Éâ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) {
                        if (this.editor) {
                            this.editor.setValue('');
                        } else {
                            this.input.value = '';
                        }
                        this.preview.innerHTML = '<p style="color: #64748b; margin-top: 150px;">TikZ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>';
                        this.log('„Ç≥„Éº„Éâ„ÇØ„É™„Ç¢ÂÆüË°å', 'success');
                    }
                });

                document.getElementById('exportPNG').addEventListener('click', () => {
                    this.exportImage('png');
                });

                document.getElementById('exportSVG').addEventListener('click', () => {
                    this.exportImage('svg');
                });
            }

            setupModes() {
                this.toolsets = {
                    basic: [
                        { code: 'draw (0,0) -- (2,0);', label: 'Á∑öÂàÜ' },
                        { code: 'draw (0,0) circle (1);', label: 'ÂÜÜ' },
                        { code: 'draw (0,0) rectangle (2,1);', label: 'Èï∑ÊñπÂΩ¢' },
                        { code: 'draw (0,0) -- (2,0) -- (1,1.5) -- cycle;', label: '‰∏âËßíÂΩ¢' },
                        { code: 'draw[fill=blue!20] (0,0) circle (1);', label: 'Â°ó„Çä„Å§„Å∂„ÅóÂÜÜ' },
                        { code: 'draw[thick,red] (0,0) -- (2,0);', label: 'Â§™Á∑ö' },
                    ],
                    graph: [
                        { code: 'draw[->] (-2,0) -- (2,0) node[right] {x};', label: 'XËª∏' },
                        { code: 'draw[->] (0,-2) -- (0,2) node[above] {y};', label: 'YËª∏' },
                        { code: 'draw[blue,thick] (-1,1) -- (0,0) -- (1,1);', label: '‰∫åÊ¨°Êõ≤Á∑ö' },
                        { code: 'draw[->] (0,0) -- (1.5,1) node[above right] {$\\vec{v}$};', label: '„Éô„ÇØ„Éà„É´' },
                        { code: 'draw[fill=red] (1,1) circle (2pt) node[above] {P};', label: 'ÁÇπ' },
                    ],
                    geometry: [
                        { code: 'draw[thick] (0,0) -- (2,2);', label: 'Â§™Á∑ö' },
                        { code: 'draw[dashed] (0,0) -- (2,2);', label: 'Á†¥Á∑ö' },
                        { code: 'draw[dotted] (0,0) -- (2,2);', label: 'ÁÇπÁ∑ö' },
                        { code: 'draw (0.3,0) arc (0:45:0.3);', label: 'Âºß' },
                        { code: 'draw[<->] (0,0) -- (2,0);', label: '‰∏°Áü¢Âç∞' },
                        { code: 'draw (0,0) node {A};', label: '„É©„Éô„É´' },
                    ],
                    coordinate: [
                        { code: 'draw[fill] (1,2) circle (2pt) node[above] {(1,2)};', label: 'Â∫ßÊ®ôÁÇπ' },
                        { code: 'draw[->] (-2,0) -- (3,0) node[right] {x}; \\draw[->] (0,-2) -- (0,3) node[above] {y};', label: 'Â∫ßÊ®ôÁ≥ª' },
                        { code: 'draw[help lines] (-2,-2) grid (2,2);', label: '„Ç∞„É™„ÉÉ„Éâ' },
                        { code: 'draw[->] (0,0) -- (2,1) node[midway,above] {Ë∑ùÈõ¢};', label: 'Ë∑ùÈõ¢' },
                        { code: 'draw (0,0) -- (1,0) -- (1,1) -- (0,1) -- cycle;', label: 'Ê≠£ÊñπÂΩ¢' },
                    ]
                };
            }

            updateToolbar() {
                const tools = this.toolsets[this.currentMode] || [];
                this.toolbar.innerHTML = tools.map(tool =>
                    `<button class="tool-btn" data-code="${tool.code}">${tool.label}</button>`
                ).join('');

                this.toolbar.querySelectorAll('.tool-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.insertCode('\\' + btn.dataset.code);
                    });
                });
            }

            insertCode(code) {
                if (this.editor) {
                    const cursor = this.editor.getCursor();
                    this.editor.replaceRange(code + '\n', cursor);
                    this.editor.focus();
                }
            }

            loadTemplate(templateName) {
                const templates = {
                    'Â∫ßÊ®ôÁ≥ª': '\\draw[->] (-2,0) -- (2,0) node[right] {x};\n\\draw[->] (0,-2) -- (0,2) node[above] {y};',
                    '‰∏âËßíÂΩ¢': '\\draw (0,0) -- (2,0) -- (1,1.5) -- cycle;\n\\draw (1,0) node[below] {A};\n\\draw (0,0) node[below left] {B};\n\\draw (1,1.5) node[above] {C};',
                    'ÂÜÜ': '\\draw (0,0) circle (1);\n\\draw (0,0) node {O};\n\\draw[fill=red] (1,0) circle (1pt) node[right] {A};',
                    '‰∫åÊ¨°Èñ¢Êï∞': '\\draw[->] (-3,0) -- (3,0) node[right] {x};\n\\draw[->] (0,-1) -- (0,4) node[above] {y};\n\\quadratic[blue,thick] (-2,4) -- (-1,1) -- (0,0) -- (1,1) -- (2,4);\n\\draw (0,0) node[below left] {O};',
                    'Ê≠£Âº¶Ê≥¢': '\\draw[->] (-4,0) -- (4,0) node[right] {x};\n\\draw[->] (0,-2) -- (0,2) node[above] {y};\n\\sine[blue,thick] (-3.14,-0.001) -- (-1.57,-1) -- (0,0) -- (1.57,1) -- (3.14,0.001);\n\\draw (0,0) node[below left] {O};',
                    '‰∏âËßíÈñ¢Êï∞': '\\draw[->] (-2,0) -- (2,0) node[right] {x};\n\\draw[->] (0,-2) -- (0,2) node[above] {y};\n\\draw (0,0) circle (1.5);\n\\draw[thick,red] (0,0) -- (1.06,1.06);\n\\draw (0.3,0) arc (0:45:0.3) node[midway,right] {Œ∏};\n\\draw (1.06,0) -- (1.06,1.06) node[midway,right] {sin Œ∏};\n\\draw (0,0) -- (1.06,0) node[midway,below] {cos Œ∏};',
                    '„Éô„ÇØ„Éà„É´': '\\draw[->] (-1,0) -- (3,0) node[right] {x};\n\\draw[->] (0,-1) -- (0,3) node[above] {y};\n\\draw[->,thick,blue] (0,0) -- (2,1.5) node[midway,above left] {$\\vec{a}$};\n\\draw[->,thick,red] (0,0) -- (1,2) node[midway,above right] {$\\vec{b}$};',
                    'ÂÜÜÂë®Ëßí': '\\draw (0,0) circle (2);\n\\draw (-1.4,1.4) -- (1.4,1.4) -- (1.4,-1.4);\n\\draw (-1.4,1.4) node[above left] {A};\n\\draw (1.4,1.4) node[above right] {B};\n\\draw (1.4,-1.4) node[below right] {C};\n\\draw (0,0) node {O};',
                    'Âπ≥Ë°åÁ∑ö': '\\draw (-2,1) -- (2,1);\n\\draw (-2,-1) -- (2,-1);\n\\draw (-1,-2) -- (1,2);\n\\draw (0.5,1) node[above] {l};\n\\draw (0.5,-1) node[below] {m};\n\\draw (0,0) node[right] {n};',
                    'ËßíÂ∫¶': '\\draw (0,0) -- (2,0) -- (1.5,1.5) -- cycle;\n\\draw (0.3,0) arc (0:35:0.3);\n\\draw (1.7,0) arc (180:145:0.3);\n\\draw (1.65,1.2) arc (215:270:0.3);\n\\draw (0.4,0.1) node {Œ±};\n\\draw (1.4,0.1) node {Œ≤};\n\\draw (1.4,1.1) node {Œ≥};',
                    'Áõ∏‰ºº': '\\draw (0,0) -- (2,0) -- (1,1.5) -- cycle;\n\\draw (3,0) -- (4,0) -- (3.5,0.75) -- cycle;\n\\draw (1,0.7) node {‚ñ≥ABC};\n\\draw (3.5,0.3) node {‚ñ≥DEF};',
                    'Á¢∫Áéá': '\\draw[->] (-0.5,0) -- (3,0) node[right] {x};\n\\draw[->] (0,-0.5) -- (0,2) node[above] {P};\n\\draw[fill=blue!20] (0,0) rectangle (0.5,1.5);\n\\draw[fill=blue!20] (0.5,0) rectangle (1,1.8);\n\\draw[fill=blue!20] (1,0) rectangle (1.5,1.2);\n\\draw[fill=blue!20] (1.5,0) rectangle (2,0.8);\n\\draw[fill=blue!20] (2,0) rectangle (2.5,0.4);'
                };

                const template = templates[templateName] || `% ${templateName}`;

                if (this.editor) {
                    this.editor.setValue(template);
                } else {
                    this.input.value = template;
                }

                setTimeout(() => this.renderTikZ(), 100);
            }

            parseTikZCode(tikzCode) {
                const commands = [];
                const lines = tikzCode.split('\n');

                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('\\draw')) {
                        const cmd = this.parseDrawCommand(line);
                        if (cmd) commands.push(cmd);
                    }
                }

                return commands;
            }

            parseDrawCommand(line) {
                // \\draw (0,0) circle (1);
                if (line.includes('circle')) {
                    const match = line.match(/\\draw.*\((.*?),(.*?)\).*circle.*\((.*?)\)/);
                    if (match) {
                        return {
                            type: 'circle',
                            center: [parseFloat(match[1]), parseFloat(match[2])],
                            radius: parseFloat(match[3])
                        };
                    }
                }

                // \\draw (0,0) rectangle (2,1);
                if (line.includes('rectangle')) {
                    const match = line.match(/\\draw.*\((.*?),(.*?)\).*rectangle.*\((.*?),(.*?)\)/);
                    if (match) {
                        return {
                            type: 'rectangle',
                            corner1: [parseFloat(match[1]), parseFloat(match[2])],
                            corner2: [parseFloat(match[3]), parseFloat(match[4])]
                        };
                    }
                }

                // ÁâπÂà•„Å™„ÉÜ„É≥„Éó„É¨„Éº„ÉàË≠òÂà•
                if (line.includes('\\quadratic') || (line.includes('blue,thick') && line.includes('4)'))) {
                    return {
                        type: 'quadratic',
                        points: this.extractCoordinates(line)
                    };
                }

                if (line.includes('\\sine') || (line.includes('blue,thick') && line.includes('-3.14,'))) {
                    return {
                        type: 'sine',
                        points: this.extractCoordinates(line)
                    };
                }

                // \\draw (x1,y1) -- (x2,y2);
                if (line.includes('--')) {
                    const coords = this.extractCoordinates(line);
                    if (coords.length >= 2) {
                        return {
                            type: 'line',
                            points: coords,
                            arrow: line.includes('->')
                        };
                    }
                }

                return null;
            }

            extractCoordinates(line) {
                const coords = [];
                const matches = line.match(/\((.*?),(.*?)\)/g);
                if (matches) {
                    for (let match of matches) {
                        const coord = match.replace(/[()]/g, '').split(',');
                        coords.push([parseFloat(coord[0]), parseFloat(coord[1])]);
                    }
                }
                return coords;
            }

            renderWithJSXGraph(commands) {
                try {
                    this.boardCounter++;
                    const boardId = 'tikz-board-' + this.boardCounter;

                    this.preview.innerHTML = `<div id="${boardId}" class="tikz-output"></div>`;

                    const board = JXG.JSXGraph.initBoard(boardId, {
                        boundingbox: [-4, 4, 4, -4],
                        axis: this.showAxis,
                        showCopyright: false,
                        showNavigation: false
                    });

                    for (let cmd of commands) {
                        if (cmd.type === 'line') {
                            const points = cmd.points.map(p => board.create('point', p, {visible: false}));
                            if (points.length >= 2) {
                                if (cmd.arrow) {
                                    // Áü¢Âç∞‰ªò„ÅçÁ∑öÂàÜ
                                    board.create('arrow', [points[0], points[1]], {
                                        strokeColor: 'black',
                                        strokeWidth: 2
                                    });
                                } else {
                                    // ÈÄöÂ∏∏„ÅÆÁ∑öÂàÜ„Åæ„Åü„ÅØÊäò„ÇåÁ∑ö
                                    for (let i = 0; i < points.length - 1; i++) {
                                        board.create('segment', [points[i], points[i + 1]], {
                                            strokeColor: 'black',
                                            strokeWidth: 2
                                        });
                                    }
                                }
                            }
                        } else if (cmd.type === 'circle') {
                            board.create('circle', [cmd.center, cmd.radius], {
                                strokeColor: 'blue',
                                strokeWidth: 2
                            });
                        } else if (cmd.type === 'rectangle') {
                            const [x1, y1] = cmd.corner1;
                            const [x2, y2] = cmd.corner2;

                            // Create the four corners of the rectangle
                            const p1 = board.create('point', [x1, y1], {visible: false});
                            const p2 = board.create('point', [x2, y1], {visible: false});
                            const p3 = board.create('point', [x2, y2], {visible: false});
                            const p4 = board.create('point', [x1, y2], {visible: false});

                            // Draw the rectangle as a polygon
                            board.create('polygon', [p1, p2, p3, p4], {
                                strokeColor: 'green',
                                strokeWidth: 2,
                                fillColor: 'none'
                            });
                        } else if (cmd.type === 'quadratic') {
                            // ‰∫åÊ¨°Èñ¢Êï∞ y = x^2 „ÇíÊèèÁîª
                            board.create('functiongraph', [function(x) {
                                return x * x;
                            }, -2, 2], {
                                strokeColor: 'blue',
                                strokeWidth: 3,
                                name: 'y = x¬≤'
                            });
                        } else if (cmd.type === 'sine') {
                            // Ê≠£Âº¶Ê≥¢ y = sin(x) „ÇíÊèèÁîª
                            board.create('functiongraph', [function(x) {
                                return Math.sin(x);
                            }, -Math.PI * 1.5, Math.PI * 1.5], {
                                strokeColor: 'blue',
                                strokeWidth: 3,
                                name: 'y = sin(x)'
                            });
                        }
                    }

                    this.log(`JSXGraph„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÂÆå‰∫Ü: ${commands.length} Ë¶ÅÁ¥†`, 'success');
                    this.status.textContent = '‚úÖ „É¨„É≥„ÉÄ„É™„É≥„Ç∞ÂÆå‰∫Ü';

                } catch (error) {
                    this.log('JSXGraph„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Ç®„É©„Éº: ' + error.message, 'error');
                    this.preview.innerHTML = `<p style="color: #ef4444; margin-top: 150px;">„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Ç®„É©„Éº: ${error.message}</p>`;
                }
            }

            renderTikZ() {
                const tikzInput = this.editor ? this.editor.getValue() : this.input.value.trim();
                if (!tikzInput) {
                    this.preview.innerHTML = '<p style="color: #64748b; margin-top: 150px;">TikZ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>';
                    return;
                }

                try {
                    this.log('„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÈñãÂßã');
                    const commands = this.parseTikZCode(tikzInput);
                    this.log(`Ëß£ÊûêÁµêÊûú: ${commands.length} „Ç≥„Éû„É≥„Éâ`);

                    if (commands.length > 0) {
                        this.renderWithJSXGraph(commands);
                    } else {
                        this.preview.innerHTML = '<p style="color: #f59e0b; margin-top: 150px;">Ëß£Êûê„Åß„Åç„Çã„Ç≥„Éû„É≥„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                    }

                } catch (error) {
                    this.preview.innerHTML = `<p style="color: #ef4444; margin-top: 150px;">„Ç®„É©„Éº: ${error.message}</p>`;
                    this.log('„É¨„É≥„ÉÄ„É™„É≥„Ç∞‰æãÂ§ñ: ' + error.message, 'error');
                }
            }

            loadSample() {
                const sample = '\\draw[->] (-2,0) -- (2,0) node[right] {x};\n\\draw[->] (0,-2) -- (0,2) node[above] {y};\n\\draw (0,0) circle (1);';

                if (this.editor) {
                    this.editor.setValue(sample);
                } else {
                    this.input.value = sample;
                }

                setTimeout(() => this.renderTikZ(), 100);
                this.log('„Çµ„É≥„Éó„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü', 'success');
            }

            exportImage(format) {
                try {
                    const boardId = 'tikz-board-' + this.boardCounter;
                    const boardElement = document.getElementById(boardId);

                    if (!boardElement) {
                        this.log('„Ç®„É©„Éº: „É¨„É≥„ÉÄ„É™„É≥„Ç∞Ê∏à„Åø„ÅÆÂõ≥ÂΩ¢„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                        alert('Âõ≥ÂΩ¢„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Åó„Å¶„Åã„ÇâÂá∫Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                        return;
                    }

                    const svgElement = boardElement.querySelector('svg');
                    if (!svgElement) {
                        this.log('„Ç®„É©„Éº: SVGË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                        alert('SVGË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                        return;
                    }

                    if (format === 'svg') {
                        this.downloadSVG(svgElement);
                    } else if (format === 'png') {
                        this.downloadPNG(svgElement);
                    }

                } catch (error) {
                    this.log('ÁîªÂÉèÂá∫Âäõ„Ç®„É©„Éº: ' + error.message, 'error');
                    alert('ÁîªÂÉèÂá∫Âäõ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
                }
            }

            downloadSVG(svgElement) {
                try {
                    // SVG„ÅÆ„ÇØ„É≠„Éº„É≥„Çí‰ΩúÊàê
                    const svgClone = svgElement.cloneNode(true);

                    // SVGË¶ÅÁ¥†„Å´namespaceÂ±ûÊÄß„ÇíËøΩÂä†
                    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                    svgClone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');

                    // SVG„ÅÆÂÜÖÂÆπ„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõ
                    const svgString = new XMLSerializer().serializeToString(svgClone);

                    // „Éï„Ç°„Ç§„É´Âêç„Å´ÁèæÂú®„ÅÆÊó•ÊôÇ„ÇíËøΩÂä†
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                    const filename = `tikz_figure_${timestamp}.svg`;

                    // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÁî®„ÅÆBlob„Çí‰ΩúÊàê
                    const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
                    const url = URL.createObjectURL(blob);

                    // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„É™„É≥„ÇØ„Çí‰ΩúÊàê„Åó„Å¶„ÇØ„É™„ÉÉ„ÇØ
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    this.log(`SVG„Éï„Ç°„Ç§„É´Âá∫ÂäõÂÆå‰∫Ü: ${filename}`, 'success');

                } catch (error) {
                    this.log('SVGÂá∫Âäõ„Ç®„É©„Éº: ' + error.message, 'error');
                    throw error;
                }
            }

            downloadPNG(svgElement) {
                try {
                    // SVG„ÅÆ„ÇØ„É≠„Éº„É≥„Çí‰ΩúÊàê
                    const svgClone = svgElement.cloneNode(true);
                    svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');

                    // SVG„ÅÆÂÜÖÂÆπ„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõ
                    const svgString = new XMLSerializer().serializeToString(svgClone);

                    // „Éï„Ç°„Ç§„É´Âêç„Å´ÁèæÂú®„ÅÆÊó•ÊôÇ„ÇíËøΩÂä†
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                    const filename = `tikz_figure_${timestamp}.png`;

                    // SVG„ÇíCanvas„Å´ÊèèÁîª„Åó„Å¶PNG„Å´Â§âÊèõÔºàCORSÂØæÂøúÁâàÔºâ
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();

                    // CORSÂØæÂøú
                    img.crossOrigin = 'anonymous';

                    img.onload = () => {
                        try {
                            // È´òÂìÅË≥™„Å™Âá∫Âäõ„ÅÆ„Åü„ÇÅ„Å´„Çµ„Ç§„Ç∫„ÇíË™øÊï¥
                            const scale = 2; // È´òDPIÂØæÂøú
                            canvas.width = img.width * scale;
                            canvas.height = img.height * scale;
                            ctx.scale(scale, scale);

                            // ËÉåÊôØ„ÇíÁôΩ„Å´Ë®≠ÂÆö
                            ctx.fillStyle = 'white';
                            ctx.fillRect(0, 0, img.width, img.height);

                            // SVGÁîªÂÉè„ÇíÊèèÁîª
                            ctx.drawImage(img, 0, 0);

                            // PNG„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                            canvas.toBlob((blob) => {
                                if (blob) {
                                    const url = URL.createObjectURL(blob);
                                    const link = document.createElement('a');
                                    link.href = url;
                                    link.download = filename;
                                    document.body.appendChild(link);
                                    link.click();
                                    document.body.removeChild(link);
                                    URL.revokeObjectURL(url);

                                    this.log(`PNG„Éï„Ç°„Ç§„É´Âá∫ÂäõÂÆå‰∫Ü: ${filename}`, 'success');
                                } else {
                                    throw new Error('Blob„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                                }
                            }, 'image/png', 1.0);
                        } catch (canvasError) {
                            this.log('CanvasÊèèÁîª„Ç®„É©„Éº: ' + canvasError.message, 'error');
                            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: SVG„Çí„Åù„ÅÆ„Åæ„Åæ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                            this.downloadSVG(svgElement);
                            alert('PNGÂá∫Âäõ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åü„Åü„ÇÅ„ÄÅSVGÂΩ¢Âºè„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ');
                        }
                    };

                    img.onerror = () => {
                        this.log('PNGÂ§âÊèõ„Ç®„É©„Éº: SVGË™≠„ÅøËæº„ÅøÂ§±Êïó', 'error');
                        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: SVG„Çí„Åù„ÅÆ„Åæ„Åæ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                        this.downloadSVG(svgElement);
                        alert('PNGÂá∫Âäõ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åü„Åü„ÇÅ„ÄÅSVGÂΩ¢Âºè„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ');
                    };

                    // SVG„ÇíData URL„Å®„Åó„Å¶ÁîªÂÉè„Å´Ë®≠ÂÆö
                    const encodedSvg = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
                    img.src = encodedSvg;

                } catch (error) {
                    this.log('PNGÂá∫Âäõ„Ç®„É©„Éº: ' + error.message, 'error');
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: SVG„Çí„Åù„ÅÆ„Åæ„Åæ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                    this.downloadSVG(svgElement);
                    alert('PNGÂá∫Âäõ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åü„Åü„ÇÅ„ÄÅSVGÂΩ¢Âºè„Åß„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ');
                }
            }
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            new TikZCreatorV3();
        });
    </script>
</body>
</html>