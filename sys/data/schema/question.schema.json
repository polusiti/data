{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Question",
  "type": "object",
  "required": ["id","subject","topic","difficulty","question","active","type"],
  "properties": {
    "id": { "type":"string","pattern":"^[a-z0-9\\-]+$" },
    "subject": { "type":"string" },
    "topic": { "type":"string" },
    "difficulty": { "type":"integer","minimum":1,"maximum":5 },
    "tags": { "type":"array","items":{"type":"string"} },
    "stem": { "type":"string" },
    "question": { "type":"string" },

    "type": { "type":"string", "enum":["mc","open","rootfrac"] },

    "choices": { "type":"array","minItems":2,"items":{"type":["string","number"]} },
    "answer": { "type":"integer","minimum":0 },

    "expected": {
      "oneOf": [
        { "type":"string" },
        {
          "type":"object",
          "properties": {
            "a": { "type":"integer" },
            "b": { "type":["integer","null"] },
            "c": { "type":["integer","null"] }
          },
          "required": ["a"],
          "additionalProperties": false
        }
      ]
    },
    "accepted": { "type":"array","items":{"type":"string"} },

    "explanation": { "type":"string" },
    "active": { "type":"boolean" },

    "assets": {
      "type":"object",
      "properties": {
        "image": { "type":["string","null"] },
        "audio": { "type":["string","null"] }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true,
  "allOf": [
    {
      "if": { "properties": { "type": { "const":"mc" } } },
      "then": { "required":["choices","answer"] }
    },
    {
      "if": { "properties": { "type": { "const":"open" } } },
      "then": {
        "anyOf":[
          { "required":["expected"] },
          { "required":["accepted"] }
        ]
      }
    },
    {
      "if": { "properties": { "type": { "const":"rootfrac" } } },
      "then": {
        "required": ["expected"],
        "properties": {
          "expected": {
            "type":"object",
            "properties": {
              "a": { "type":"integer" },
              "b": { "type":["integer","null"] },
              "c": { "type":["integer","null"] }
            },
            "required":["a"],
            "additionalProperties": false
          }
        }
      }
    }
  ]
}
