<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>認証テスト - 問題管理システム</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>🔧 認証システムテスト</h1>
    <div id="testResults"></div>
    
    <script src="auth-simple.js"></script>
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('testResults').appendChild(div);
        }
        
        // テスト1: 認証システムが利用可能か
        addResult('テスト1: 認証システムの確認...', 'info');
        if (window.auth || window.AuthenticationSystem) {
            addResult('✅ 認証システムが利用可能です', 'success');
        } else {
            addResult('❌ 認証システムが見つかりません', 'error');
        }
        
        // テスト2: デモモードのテスト
        addResult('テスト2: デモモードの確認...', 'info');
        try {
            if (window.auth) {
                window.auth.enableDemoMode();
                const user = window.auth.getCurrentUser();
                if (user && user.role === 'admin') {
                    addResult('✅ デモモードが有効です', 'success');
                } else {
                    addResult('❌ デモモードの有効化に失敗しました', 'error');
                }
            } else if (window.AuthenticationSystem) {
                window.AuthenticationSystem.enableDemoMode();
                const user = window.AuthenticationSystem.getCurrentUser();
                if (user && user.role === 'admin') {
                    addResult('✅ デモモードが有効です', 'success');
                } else {
                    addResult('❌ デモモードの有効化に失敗しました', 'error');
                }
            }
        } catch (e) {
            addResult(`❌ エラーが発生しました: ${e.message}`, 'error');
        }
        
        // テスト3: 権限チェック
        addResult('テスト3: 権限チェック...', 'info');
        const currentUser = window.auth?.getCurrentUser() || window.AuthenticationSystem?.getCurrentUser();
        if (currentUser && currentUser.permissions) {
            addResult(`✅ 現在のユーザー: ${currentUser.displayName} (${currentUser.role})`, 'success');
            addResult(`権限: ${currentUser.permissions.join(', ')}`, 'info');
        } else {
            addResult('❌ ユーザー情報が取得できません', 'error');
        }
        
        // テスト4: データベース接続
        addResult('テスト4: データベース接続...', 'info');
        const script = document.createElement('script');
        script.src = 'database-fixed.js';
        script.onload = () => {
            if (window.Database) {
                addResult('✅ データベースシステムが利用可能です', 'success');
            } else {
                addResult('❌ データベースシステムが見つかりません', 'error');
            }
        };
        script.onerror = () => {
            addResult('❌ データベーススクリプトの読み込みに失敗しました', 'error');
        };
        document.head.appendChild(script);
        
        addResult('\n📝 テスト完了！各ページにアクセスして機能を確認してください。', 'info');
    </script>
</body>
</html>