<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Answer UI デモ（A1/A2/A3/F1/F2）</title>
  <style>
    :root{ color-scheme: light dark; }
    body{ font-family: ui-sans-serif, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Arial, sans-serif; margin:16px; }
    h1{ margin:0 0 12px; }
    textarea, input{ width:100%; max-width: 880px; box-sizing: border-box; padding:8px; }
    button{ padding:8px 12px; margin-right:8px; }
    pre{ background:#0f172a; color:#e2e8f0; padding:12px; border-radius:8px; overflow:auto; max-width:880px; }
    .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin:8px 0; }
    .note{ color:#475569; font-size:.92rem; margin:6px 0 12px; }
    .wrap{ max-width: 960px; }
    .sep{ height:1px; background: color-mix(in oklab, #000, #fff 85%); opacity:.2; margin:14px 0; }
    label{ user-select:none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Answer UI デモ <span id="version" style="color:#666;font-size:0.7em;"></span></h1>
    <p class="note">A1/A2/A3（択一）と、F1（(a,√b,c) 入力＝センター試験風の縦分数編集にも対応）、F2（自由入力）をモーダルで出します。JSON コマンドでも実行できます。</p>

    <div class="row">
      <button id="btnA1">A1（四択）</button>
      <button id="btnA2">A2（六択）</button>
      <button id="btnA3">A3（九択）</button>
      <button id="btnF1">F1（コンパクト ver1.0）</button>
      <button id="btnF1Sheet">F1（センター試験風 ver3.0）</button>
      <button id="btnF2">F2（自由入力）</button>
      <span style="flex:1 1 auto"></span>
      <label>テーマ:
        <select id="themeSel">
          <option value="auto">自動</option>
          <option value="light">ライト</option>
          <option value="dark">ダーク</option>
        </select>
      </label>
      <label><input type="checkbox" id="allowCancel" checked> キャンセル可</label>
    </div>

    <div class="sep"></div>

    <h2 style="margin:0 0 8px">JSON コマンド</h2>
    <p class="note">f1Layout: "compact"(ver1.0), "anaume"(ver1.5), "sheet"(ver3.0)が利用可能</p>
    <textarea id="jsonInput" rows="12">
{
  "cmd": "answer.open",
  "id": "sample-q",
  "mode": "A1",
  "question": "次のうち、素数はどれ？",
  "choices": ["12", "17", "21", "27"],
  "ui": { "theme": "auto", "allowCancel": true, "submitLabel": "決定" }
}
    </textarea>
    <div class="row">
      <button id="runBtn">この JSON を実行</button>
    </div>

    <div class="sep"></div>

    <h2 style="margin:0 0 8px">結果</h2>
    <pre id="result">実行結果がここに表示されます</pre>
  </div>

  <script src="./answer-ui.js"></script>
  <script>
    const input = document.getElementById('jsonInput');
    const resultEl = document.getElementById('result');
    const themeSel = document.getElementById('themeSel');
    const allowCancel = document.getElementById('allowCancel');

    function applyUi(cmd){
      cmd.ui = cmd.ui || {};
      cmd.ui.theme = themeSel.value;
      cmd.ui.allowCancel = allowCancel.checked;
      return cmd;
    }

    function showResult(res){
      resultEl.textContent = JSON.stringify(res, null, 2);
    }

    document.getElementById('runBtn').addEventListener('click', async ()=>{
      try{
        const cmd = JSON.parse(input.value);
        applyUi(cmd);
        const res = await window.AnswerUI.open(cmd);
        showResult(res);
      }catch(e){
        alert('JSON パースまたは実行エラー: ' + e.message);
      }
    });

    document.getElementById('btnA1').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-A1",
        mode: "A1",
        question: "次のうち、素数はどれ？",
        choices: ["12", "17", "21", "27"],
        ui: { submitLabel: "決定" }
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    document.getElementById('btnA2').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-A2",
        mode: "A2",
        question: "好きな色を選んでください",
        choices: ["赤","青","緑","黄","白","黒"]
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    document.getElementById('btnA3').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-A3",
        mode: "A3",
        question: "9つの中から1つ選ぶテスト",
        choices: ["1","2","3","4","5","6","7","8","9"]
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    document.getElementById('btnF1').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-F1",
        mode: "F1",
        question: "分数の形 (a + √b) / c を入力してください（整数）",
        defaults: { a: 1, b: 2, c: 1 },
        limits: { a: {min:-99, max:99}, b: {min:0, max:9999}, c: {min:-99, max:99} },
        ui: { submitLabel: "OK", f1Layout: "compact" }
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    document.getElementById('btnF1Sheet').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-F1-sheet",
        mode: "F1",
        question: "次の式をセンター試験風の縦分数で入力してください",
        defaults: { a: 12, b: 345, c: 67 },
        limits: { a: {min:-999, max:999}, b: {min:0, max:9999}, c: {min:-999, max:999} },
        ui: { submitLabel: "OK", f1Layout: "sheet", f1Digits: { a: 3, b: 4, c: 3 } }
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    document.getElementById('btnF2').addEventListener('click', ()=>{
      const cmd = {
        cmd: "answer.open",
        id: "q-F2",
        mode: "F2",
        question: "自由入力で解答してください",
        defaults: { text: "" },
        ui: { submitLabel: "送信" }
      };
      input.value = JSON.stringify(applyUi(cmd), null, 2);
    });

    // 初回結果スペース
    showResult({note: "ここに結果が表示されます"});
    
    // バージョン表示
    document.getElementById('version').textContent = `v${window.AnswerUI.version}`;
  </script>
</body>
</html>
