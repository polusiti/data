<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>問題作成ツール</title>
  <meta name="description" content="スマホ対応の問題作成ツール">
  <meta name="theme-color" content="#3b82f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="問題作成ツール">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="apple-touch-icon" href="/icon-192.png">
  
  <!-- CSS -->
  <link rel="stylesheet" href="/css/style.css">
  
  <!-- Prevent zoom on input focus -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select {
      font-size: 16px; /* Prevent zoom on iOS */
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen pb-16">
  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-40">
    <div class="px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl font-bold text-gray-800">問題作成ツール</h1>
      <div class="flex gap-2">
        <button id="searchBtn" class="touch-target p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>
        <button id="themeBtn" class="touch-target p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main id="app" class="container mx-auto px-4 py-4 max-w-4xl">
    <!-- Loading State -->
    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
      <div class="bg-white rounded-lg p-6 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"></div>
        <p class="text-gray-600">読み込み中...</p>
      </div>
    </div>

    <!-- Views -->
    <div id="dashboardView" class="view">
      <!-- Stats Cards -->
      <div class="grid grid-cols-2 gap-3 mb-6">
        <div class="bg-white rounded-xl p-4 shadow-sm">
          <div class="text-2xl font-bold text-primary-600" id="totalQuestions">-</div>
          <div class="text-sm text-gray-600">総問題数</div>
        </div>
        <div class="bg-white rounded-xl p-4 shadow-sm">
          <div class="text-2xl font-bold text-green-600" id="todayCreated">-</div>
          <div class="text-sm text-gray-600">今日作成</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
        <h2 class="text-lg font-semibold mb-3">クイックアクション</h2>
        <div class="grid grid-cols-2 gap-3">
          <button onclick="app.showCreateForm()" class="mobile-button bg-primary-500 text-white hover:bg-primary-600">
            <svg class="w-5 h-5 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            新規作成
          </button>
          <button onclick="app.showTemplates()" class="mobile-button bg-gray-100 text-gray-700 hover:bg-gray-200">
            <svg class="w-5 h-5 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
            </svg>
            テンプレート
          </button>
        </div>
      </div>

      <!-- Recent Questions -->
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <h2 class="text-lg font-semibold mb-3">最近の問題</h2>
        <div id="recentQuestions" class="space-y-2">
          <!-- Questions will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Create/Edit Form View -->
    <div id="formView" class="view hidden">
      <div class="bg-white rounded-xl p-4 shadow-sm mb-4">
        <h2 class="text-lg font-semibold mb-4">問題作成</h2>
        
        <form id="questionForm" class="space-y-4">
          <!-- Subject Selection -->
          <div class="field-group">
            <label class="field-label">教科</label>
            <select id="subject" class="field-input" required>
              <option value="">選択してください</option>
              <option value="math">数学</option>
              <option value="english">英語</option>
              <option value="chemistry">化学</option>
              <option value="physics">物理</option>
              <option value="info">情報</option>
              <option value="law">法学</option>
            </select>
          </div>

          <!-- Topic Input -->
          <div class="field-group">
            <label class="field-label">トピック</label>
            <input type="text" id="topic" class="field-input" placeholder="例：二次方程式">
          </div>

          <!-- Answer Format -->
          <div class="field-group">
            <label class="field-label">解答形式</label>
            <select id="answerFormat" class="field-input" required>
              <option value="">選択してください</option>
              <option value="A1">4択問題 (A1)</option>
              <option value="A2">6択問題 (A2)</option>
              <option value="A3">9択問題 (A3)</option>
              <option value="F1">分数入力 (F1)</option>
              <option value="F2">自由記述 (F2)</option>
            </select>
          </div>

          <!-- Question Text -->
          <div class="field-group">
            <label class="field-label">問題文</label>
            <div class="relative">
              <textarea id="questionText" class="field-textarea" rows="3" 
                placeholder="問題文を入力...&#10;LaTeX: $x^2 + y^2 = z^2$"
                required></textarea>
              <button type="button" onclick="app.insertLatex()" 
                class="absolute top-2 right-2 touch-target p-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">
                LaTeX
              </button>
            </div>
          </div>

          <!-- Choices (for A1, A2, A3) -->
          <div id="choicesSection" class="hidden field-group">
            <label class="field-label">選択肢</label>
            <div id="choicesContainer" class="space-y-2">
              <!-- Choices will be added dynamically -->
            </div>
          </div>

          <!-- Correct Answer -->
          <div class="field-group">
            <label class="field-label">正解</label>
            <input type="text" id="correctAnswer" class="field-input" 
              placeholder="正解を入力">
          </div>

          <!-- Explanation -->
          <div class="field-group">
            <label class="field-label">解説</label>
            <textarea id="explanation" class="field-textarea" rows="3" 
              placeholder="解説を入力..."></textarea>
          </div>

          <!-- Image Upload -->
          <div class="field-group">
            <label class="field-label">画像</label>
            <input type="file" id="imageUpload" class="field-input" 
              accept="image/*" capture="environment">
          </div>

          <!-- Actions -->
          <div class="flex gap-3 pt-4">
            <button type="submit" class="mobile-button bg-primary-500 text-white hover:bg-primary-600 flex-1">
              保存
            </button>
            <button type="button" onclick="app.showDashboard()" 
              class="mobile-button bg-gray-100 text-gray-700 hover:bg-gray-200">
              キャンセル
            </button>
          </div>
        </form>
      </div>

      <!-- Preview Section -->
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <h3 class="text-lg font-semibold mb-3">プレビュー</h3>
        <div id="preview" class="prose max-w-none">
          <!-- Preview will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Search View -->
    <div id="searchView" class="view hidden">
      <div class="bg-white rounded-xl p-4 shadow-sm mb-4">
        <div class="relative">
          <input type="search" id="searchInput" class="field-input pr-10" 
            placeholder="問題を検索...">
          <button class="absolute right-2 top-1/2 transform -translate-y-1/2">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </button>
        </div>
        
        <!-- Filters -->
        <div class="mt-3 flex gap-2 overflow-x-auto">
          <button class="filter-chip active" data-filter="all">すべて</button>
          <button class="filter-chip" data-filter="math">数学</button>
          <button class="filter-chip" data-filter="english">英語</button>
          <button class="filter-chip" data-filter="chemistry">化学</button>
          <button class="filter-chip" data-filter="physics">物理</button>
        </div>
      </div>

      <!-- Search Results -->
      <div id="searchResults" class="space-y-2">
        <!-- Results will be loaded here -->
      </div>
    </div>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-item active" data-view="dashboard">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
      </svg>
      <span class="text-xs mt-1">ホーム</span>
    </button>
    <button class="nav-item" data-view="form">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      <span class="text-xs mt-1">作成</span>
    </button>
    <button class="nav-item" data-view="search">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <span class="text-xs mt-1">検索</span>
    </button>
  </nav>

  <!-- JavaScript -->
  <script type="module" src="/js/bundle.js"></script>
</body>
</html>