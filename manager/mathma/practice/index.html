<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ ÂïèÈ°åÁ∑¥Áøí - Â≠¶Áøí„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        :root {
            --primary-color: #ec4899;
            --secondary-color: #be185d;
            --accent-color: #f472b6;
            --bg-color: #fdf2f8;
            --text-color: #1f2937;
            --border-color: #fbcfe8;
            --hover-bg: #fce7f3;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 5px solid var(--primary-color);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .nav-breadcrumb {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .nav-breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            margin-right: 10px;
        }

        .practice-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .mode-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, white, #fdf2f8);
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
            color: var(--primary-color);
        }

        .mode-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
            text-align: center;
        }

        .mode-description {
            color: #6b7280;
            text-align: center;
            margin-bottom: 15px;
        }

        .mode-features {
            list-style: none;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .mode-features li {
            padding: 3px 0;
        }

        .mode-features li:before {
            content: "‚úì ";
            color: var(--primary-color);
            font-weight: bold;
        }

        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .settings-section.show {
            display: block;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
        }

        .setting-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .setting-group select,
        .setting-group input {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .setting-group select:focus,
        .setting-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .practice-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }

        .practice-area.show {
            display: block;
        }

        .progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            height: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .question-display {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid var(--primary-color);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .question-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .question-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .choices-area {
            margin: 20px 0;
        }

        .choice-item {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-item:hover {
            border-color: var(--primary-color);
            background: var(--hover-bg);
        }

        .choice-item.selected {
            border-color: var(--primary-color);
            background: #fce7f3;
        }

        .choice-item.correct {
            border-color: var(--success-color);
            background: #d1fae5;
        }

        .choice-item.incorrect {
            border-color: var(--error-color);
            background: #fee2e2;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1.1rem;
            margin: 15px 0;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .result-display {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .result-display.show {
            display: block;
        }

        .result-display.correct {
            border: 3px solid var(--success-color);
            background: linear-gradient(135deg, #d1fae5, white);
        }

        .result-display.incorrect {
            border: 3px solid var(--error-color);
            background: linear-gradient(135deg, #fee2e2, white);
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .result-message {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .explanation-area {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            text-align: left;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-large {
            padding: 15px 40px;
            font-size: 1.1rem;
        }

        .stats-summary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-item p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .timer {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .practice-modes {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .question-meta {
                flex-direction: column;
                align-items: stretch;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-breadcrumb">
            <a href="../">üî¢ Math Manager</a> ‚Üí <span>üéØ ÂïèÈ°åÁ∑¥Áøí</span>
        </div>

        <div class="header">
            <h1>üéØ ÂïèÈ°åÁ∑¥Áøí</h1>
            <p>ÂÆüÈöõ„Å´Êï∞Â≠¶ÂïèÈ°å„ÇíËß£„ÅÑ„Å¶Â≠¶Áøí‰ΩìÈ®ì</p>
        </div>

        <div class="stats-summary">
            <h3>Â≠¶ÁøíÈÄ≤Êçó</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <h3 id="totalAttempts">0</h3>
                    <p>Á∑èËß£Á≠îÊï∞</p>
                </div>
                <div class="stat-item">
                    <h3 id="correctRate">0%</h3>
                    <p>Ê≠£Á≠îÁéá</p>
                </div>
                <div class="stat-item">
                    <h3 id="streakCount">0</h3>
                    <p>ÈÄ£Á∂öÊ≠£Ëß£</p>
                </div>
                <div class="stat-item">
                    <h3 id="averageTime">0s</h3>
                    <p>Âπ≥ÂùáÊôÇÈñì</p>
                </div>
            </div>
        </div>

        <!-- Á∑¥Áøí„É¢„Éº„ÉâÈÅ∏Êäû -->
        <div class="practice-modes" id="practiceModesSection">
            <div class="mode-card" onclick="selectMode('random')">
                <div class="mode-icon">üé≤</div>
                <div class="mode-title">„É©„É≥„ÉÄ„É†Á∑¥Áøí</div>
                <div class="mode-description">ÂÖ®ÂïèÈ°å„Åã„Çâ„É©„É≥„ÉÄ„É†„Å´Âá∫È°å</div>
                <ul class="mode-features">
                    <li>„Éê„É©„É≥„Çπ„Çà„ÅèÂ≠¶Áøí</li>
                    <li>Âº±ÁÇπÁô∫Ë¶ã„Å´ÂäπÊûúÁöÑ</li>
                    <li>ÂÖ®ÂàÜÈáéÂØæÂøú</li>
                </ul>
            </div>
            
            <div class="mode-card" onclick="selectMode('difficulty')">
                <div class="mode-icon">üìä</div>
                <div class="mode-title">Èõ£ÊòìÂ∫¶Âà•Á∑¥Áøí</div>
                <div class="mode-description">Èõ£ÊòìÂ∫¶„ÇíÊåáÂÆö„Åó„Å¶ÈõÜ‰∏≠Â≠¶Áøí</div>
                <ul class="mode-features">
                    <li>ÊÆµÈöéÁöÑ„É¨„Éô„É´„Ç¢„ÉÉ„Éó</li>
                    <li>Âü∫Á§éÂõ∫„ÇÅ„Å´ÊúÄÈÅ©</li>
                    <li>Êòì„Éª‰∏≠„ÉªÈõ£„Åã„ÇâÈÅ∏Êäû</li>
                </ul>
            </div>

            <div class="mode-card" onclick="selectMode('category')">
                <div class="mode-icon">üìö</div>
                <div class="mode-title">ÂàÜÈáéÂà•Á∑¥Áøí</div>
                <div class="mode-description">ÁâπÂÆöÂàÜÈáé„ÇíÈõÜ‰∏≠ÁöÑ„Å´Â≠¶Áøí</div>
                <ul class="mode-features">
                    <li>Ëã¶ÊâãÂàÜÈáéÂÖãÊúç</li>
                    <li>Â∞ÇÈñÄÂàÜÈáéÂº∑Âåñ</li>
                    <li>ÂäπÁéáÁöÑÂ≠¶Áøí</li>
                </ul>
            </div>

            <div class="mode-card" onclick="selectMode('timed')">
                <div class="mode-icon">‚è±Ô∏è</div>
                <div class="mode-title">ÊôÇÈñìÂà∂ÈôêÁ∑¥Áøí</div>
                <div class="mode-description">Âà∂ÈôêÊôÇÈñìÂÜÖ„Åß„ÅÆÂÆüÊà¶Á∑¥Áøí</div>
                <ul class="mode-features">
                    <li>Ë©¶È®ìÂØæÁ≠ñ„Å´ÊúÄÈÅ©</li>
                    <li>ÊôÇÈñìÊÑüË¶ö„ÇíÈ§äÊàê</li>
                    <li>ÈõÜ‰∏≠ÂäõÂêë‰∏ä</li>
                </ul>
            </div>
        </div>

        <!-- Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="settings-section" id="settingsSection">
            <h3 style="color: var(--primary-color); margin-bottom: 20px;">üìã Á∑¥ÁøíË®≠ÂÆö</h3>
            <div class="settings-grid">
                <div class="setting-group">
                    <label for="questionCount">ÂïèÈ°åÊï∞</label>
                    <select id="questionCount">
                        <option value="5">5Âïè</option>
                        <option value="10" selected>10Âïè</option>
                        <option value="15">15Âïè</option>
                        <option value="20">20Âïè</option>
                        <option value="all">„Åô„Åπ„Å¶</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="difficultyFilter">Èõ£ÊòìÂ∫¶</label>
                    <select id="difficultyFilter">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <option value="Êòì">Êòì (Âü∫Á§é)</option>
                        <option value="‰∏≠">‰∏≠ (Ê®ôÊ∫ñ)</option>
                        <option value="Èõ£">Èõ£ (Áô∫Â±ï)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="categoryFilter">ÂàÜÈáé</label>
                    <select id="categoryFilter">
                        <option value="">„Åô„Åπ„Å¶</option>
                    </select>
                </div>
                <div class="setting-group" id="timerSetting" style="display: none;">
                    <label for="timeLimit">Âà∂ÈôêÊôÇÈñì (Áßí)</label>
                    <input type="number" id="timeLimit" value="60" min="30" max="600">
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary btn-large" onclick="startPractice()">üöÄ Á∑¥ÁøíÈñãÂßã</button>
                <button class="btn btn-secondary" onclick="goBack()">‚Üê Êàª„Çã</button>
            </div>
        </div>

        <!-- Á∑¥Áøí„Ç®„É™„Ç¢ -->
        <div class="practice-area" id="practiceArea">
            <div class="timer" id="timerDisplay" style="display: none;">
                <div>ÊÆã„ÇäÊôÇÈñì</div>
                <div class="timer-display" id="timeRemaining">60</div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;">
                    <span id="progressText">0/0</span>
                </div>
            </div>

            <div class="question-display" id="questionDisplay">
                <!-- ÂïèÈ°å„ÅåË°®Á§∫„Åï„Çå„Çã -->
            </div>

            <div class="result-display" id="resultDisplay">
                <!-- ÁµêÊûú„ÅåË°®Á§∫„Åï„Çå„Çã -->
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary btn-large" id="submitAnswer" onclick="submitAnswer()" style="display: none;">ÂõûÁ≠î„Åô„Çã</button>
                <button class="btn btn-success" id="nextQuestion" onclick="nextQuestion()" style="display: none;">Ê¨°„ÅÆÂïèÈ°å ‚Üí</button>
                <button class="btn btn-warning" onclick="finishPractice()" id="finishButton" style="display: none;">Á∑¥ÁøíÁµÇ‰∫Ü</button>
                <button class="btn btn-secondary" onclick="goToModeSelection()">‚Üê „É¢„Éº„ÉâÈÅ∏Êäû„Å´Êàª„Çã</button>
            </div>
        </div>
    </div>

    <script>
        // ÂïèÈ°åÁ∑¥Áøí„Ç∑„Çπ„ÉÜ„É†
        class PracticeSystem {
            constructor() {
                this.questions = [];
                this.currentMode = null;
                this.practiceQuestions = [];
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.stats = this.loadStats();
                this.timer = null;
                this.startTime = null;
                this.init();
            }

            init() {
                this.loadQuestions();
                this.populateFilters();
                this.updateStatsDisplay();
            }

            loadQuestions() {
                this.questions = JSON.parse(localStorage.getItem('mathQuestions') || '[]')
                    .filter(q => (q.approvals || 0) >= 3); // ÊâøË™çÊ∏à„Åø„ÅÆ„Åø
            }

            loadStats() {
                return JSON.parse(localStorage.getItem('practiceStats') || JSON.stringify({
                    totalAttempts: 0,
                    correctAnswers: 0,
                    totalTime: 0,
                    streak: 0,
                    bestStreak: 0
                }));
            }

            saveStats() {
                localStorage.setItem('practiceStats', JSON.stringify(this.stats));
            }

            populateFilters() {
                const categories = [...new Set(this.questions.map(q => q.category).filter(Boolean))];
                const categorySelect = document.getElementById('categoryFilter');
                
                categorySelect.innerHTML = '<option value="">„Åô„Åπ„Å¶</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }

            updateStatsDisplay() {
                const correctRate = this.stats.totalAttempts > 0 ? 
                    Math.round((this.stats.correctAnswers / this.stats.totalAttempts) * 100) : 0;
                const averageTime = this.stats.totalAttempts > 0 ?
                    Math.round(this.stats.totalTime / this.stats.totalAttempts) : 0;

                document.getElementById('totalAttempts').textContent = this.stats.totalAttempts;
                document.getElementById('correctRate').textContent = correctRate + '%';
                document.getElementById('streakCount').textContent = this.stats.streak;
                document.getElementById('averageTime').textContent = averageTime + 's';
            }

            selectMode(mode) {
                this.currentMode = mode;
                
                // „É¢„Éº„Éâ„Ç´„Éº„Éâ„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');

                // Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                document.getElementById('practiceModesSection').style.display = 'none';
                document.getElementById('settingsSection').classList.add('show');

                // ÊôÇÈñìÂà∂Èôê„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÄÅ„Çø„Ç§„Éû„ÉºË®≠ÂÆö„ÇíË°®Á§∫
                const timerSetting = document.getElementById('timerSetting');
                if (mode === 'timed') {
                    timerSetting.style.display = 'block';
                } else {
                    timerSetting.style.display = 'none';
                }
            }

            startPractice() {
                const questionCount = document.getElementById('questionCount').value;
                const difficultyFilter = document.getElementById('difficultyFilter').value;
                const categoryFilter = document.getElementById('categoryFilter').value;

                // ÂïèÈ°å„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                let filteredQuestions = [...this.questions];
                
                if (difficultyFilter) {
                    filteredQuestions = filteredQuestions.filter(q => q.difficulty === difficultyFilter);
                }
                
                if (categoryFilter) {
                    filteredQuestions = filteredQuestions.filter(q => q.category === categoryFilter);
                }

                if (filteredQuestions.length === 0) {
                    alert('Êù°‰ª∂„Å´Âêà„ÅÜÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Éï„Ç£„É´„Çø„ÉºË®≠ÂÆö„ÇíÂ§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                // ÂïèÈ°åÊï∞„ÇíÊ±∫ÂÆö
                const maxQuestions = questionCount === 'all' ? filteredQuestions.length : parseInt(questionCount);
                
                // ÂïèÈ°å„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶ÈÅ∏Êäû
                this.practiceQuestions = this.shuffleArray([...filteredQuestions]).slice(0, maxQuestions);
                this.currentQuestionIndex = 0;
                this.userAnswers = [];

                // Á∑¥ÁøíÈñãÂßã
                document.getElementById('settingsSection').classList.remove('show');
                document.getElementById('practiceArea').classList.add('show');

                this.displayCurrentQuestion();
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            displayCurrentQuestion() {
                if (this.currentQuestionIndex >= this.practiceQuestions.length) {
                    this.showResults();
                    return;
                }

                const question = this.practiceQuestions[this.currentQuestionIndex];
                this.startTime = Date.now();

                // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
                const progress = ((this.currentQuestionIndex) / this.practiceQuestions.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('progressText').textContent = 
                    `${this.currentQuestionIndex + 1}/${this.practiceQuestions.length}`;

                // ÂïèÈ°åË°®Á§∫
                const questionDisplay = document.getElementById('questionDisplay');
                questionDisplay.innerHTML = `
                    <div class="question-meta">
                        <div>
                            <span class="tag">${question.type}</span>
                            <span class="tag">${question.difficulty}</span>
                            <span class="tag">${question.category}</span>
                        </div>
                        <div>ÂïèÈ°å ${this.currentQuestionIndex + 1} / ${this.practiceQuestions.length}</div>
                    </div>
                    <div class="question-title">${question.title}</div>
                    <div class="question-content">${question.question}</div>
                    <div id="answerArea">${this.renderAnswerArea(question)}</div>
                `;

                // „Éú„Çø„É≥Ë°®Á§∫Ë™øÊï¥
                document.getElementById('submitAnswer').style.display = 'inline-block';
                document.getElementById('nextQuestion').style.display = 'none';
                document.getElementById('resultDisplay').classList.remove('show');

                // „Çø„Ç§„Éû„ÉºÈñãÂßãÔºàÊôÇÈñìÂà∂Èôê„É¢„Éº„Éâ„ÅÆÂ†¥ÂêàÔºâ
                if (this.currentMode === 'timed') {
                    this.startTimer();
                }
            }

            renderAnswerArea(question) {
                if (question.type === 'A1') {
                    return `
                        <div class="choices-area">
                            ${question.choices.map((choice, index) => `
                                <div class="choice-item" onclick="selectChoice(${index})">
                                    ${index + 1}. ${choice}
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    return `
                        <textarea class="answer-input" id="freeAnswer" 
                                  placeholder="${question.type === 'F1' ? 'Êï∞ÂÄ§„ÇÑÁü≠„ÅÑÁ≠î„Åà„ÇíÂÖ•Âäõ' : 'Ë©≥Á¥∞„Å™Ëß£Á≠î„ÇíË®òËø∞'}"></textarea>
                    `;
                }
            }

            startTimer() {
                const timeLimit = parseInt(document.getElementById('timeLimit').value);
                let timeRemaining = timeLimit;
                
                document.getElementById('timerDisplay').style.display = 'block';
                
                this.timer = setInterval(() => {
                    timeRemaining--;
                    document.getElementById('timeRemaining').textContent = timeRemaining;
                    
                    if (timeRemaining <= 0) {
                        this.submitAnswer();
                    }
                }, 1000);
            }

            stopTimer() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
                document.getElementById('timerDisplay').style.display = 'none';
            }

            selectChoice(choiceIndex) {
                // Êó¢Â≠ò„ÅÆÈÅ∏Êäû„ÇíËß£Èô§
                document.querySelectorAll('.choice-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Êñ∞„Åó„ÅÑÈÅ∏Êäû„ÇíË®≠ÂÆö
                document.querySelectorAll('.choice-item')[choiceIndex].classList.add('selected');
                
                // ÈÅ∏Êäû„Åó„ÅüÁ≠î„Åà„ÇíË®òÈå≤
                this.selectedChoice = choiceIndex;
            }

            submitAnswer() {
                const question = this.practiceQuestions[this.currentQuestionIndex];
                const endTime = Date.now();
                const timeSpent = Math.round((endTime - this.startTime) / 1000);
                
                this.stopTimer();

                let userAnswer = null;
                let isCorrect = false;

                if (question.type === 'A1') {
                    userAnswer = this.selectedChoice;
                    isCorrect = userAnswer === question.correct;
                } else {
                    userAnswer = document.getElementById('freeAnswer').value.trim();
                    // F1/F2„ÅÆÊ≠£Ëß£Âà§ÂÆö„ÅØÁ∞°Áï•ÂåñÔºàÂÆüÈöõ„ÅØ„Çà„ÇäË§áÈõë„Å™Âà§ÂÆö„ÅåÂøÖË¶ÅÔºâ
                    isCorrect = userAnswer.toLowerCase() === (question.answer || '').toLowerCase();
                }

                // Áµ±Ë®àÊõ¥Êñ∞
                this.stats.totalAttempts++;
                this.stats.totalTime += timeSpent;
                
                if (isCorrect) {
                    this.stats.correctAnswers++;
                    this.stats.streak++;
                    this.stats.bestStreak = Math.max(this.stats.bestStreak, this.stats.streak);
                } else {
                    this.stats.streak = 0;
                }

                this.saveStats();
                this.updateStatsDisplay();

                // ÁµêÊûú‰øùÂ≠ò
                this.userAnswers.push({
                    question: question,
                    userAnswer: userAnswer,
                    isCorrect: isCorrect,
                    timeSpent: timeSpent
                });

                // ÁµêÊûúË°®Á§∫
                this.showAnswerResult(question, userAnswer, isCorrect);
                
                // „Éú„Çø„É≥Ë°®Á§∫Ë™øÊï¥
                document.getElementById('submitAnswer').style.display = 'none';
                if (this.currentQuestionIndex < this.practiceQuestions.length - 1) {
                    document.getElementById('nextQuestion').style.display = 'inline-block';
                } else {
                    document.getElementById('finishButton').style.display = 'inline-block';
                }
            }

            showAnswerResult(question, userAnswer, isCorrect) {
                const resultDisplay = document.getElementById('resultDisplay');
                const resultClass = isCorrect ? 'correct' : 'incorrect';
                const resultIcon = isCorrect ? 'üéâ' : 'üòÖ';
                const resultMessage = isCorrect ? 'Ê≠£Ëß£„Åß„ÅôÔºÅ' : '‰∏çÊ≠£Ëß£„Åß„Åô';

                resultDisplay.className = `result-display show ${resultClass}`;
                resultDisplay.innerHTML = `
                    <div class="result-icon">${resultIcon}</div>
                    <div class="result-message">${resultMessage}</div>
                    ${!isCorrect && question.type === 'A1' ? `
                        <p><strong>Ê≠£Ëß£:</strong> ${question.choices[question.correct]}</p>
                    ` : ''}
                    ${!isCorrect && (question.type === 'F1' || question.type === 'F2') ? `
                        <p><strong>Ê≠£Ëß£:</strong> ${question.answer}</p>
                    ` : ''}
                    ${question.explanation ? `
                        <div class="explanation-area">
                            <strong>Ëß£Ë™¨:</strong><br>
                            ${question.explanation}
                        </div>
                    ` : ''}
                `;

                // A1Êäû„ÅÆÂ†¥Âêà„ÄÅÊ≠£Ëß£/‰∏çÊ≠£Ëß£„Çí„Éì„Ç∏„É•„Ç¢„É´Ë°®Á§∫
                if (question.type === 'A1') {
                    document.querySelectorAll('.choice-item').forEach((item, index) => {
                        if (index === question.correct) {
                            item.classList.add('correct');
                        } else if (index === userAnswer && !isCorrect) {
                            item.classList.add('incorrect');
                        }
                    });
                }
            }

            nextQuestion() {
                this.currentQuestionIndex++;
                this.selectedChoice = null;
                this.displayCurrentQuestion();
            }

            showResults() {
                const correct = this.userAnswers.filter(a => a.isCorrect).length;
                const total = this.userAnswers.length;
                const accuracy = Math.round((correct / total) * 100);
                const totalTime = this.userAnswers.reduce((sum, a) => sum + a.timeSpent, 0);
                const averageTime = Math.round(totalTime / total);

                document.getElementById('practiceArea').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h2 style="color: var(--primary-color); margin-bottom: 30px;">
                            üéØ Á∑¥ÁøíÂÆå‰∫ÜÔºÅ
                        </h2>
                        
                        <div class="stats-summary">
                            <h3>‰ªäÂõû„ÅÆÁµêÊûú</h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <h3>${correct}/${total}</h3>
                                    <p>Ê≠£Ëß£Êï∞</p>
                                </div>
                                <div class="stat-item">
                                    <h3>${accuracy}%</h3>
                                    <p>Ê≠£Á≠îÁéá</p>
                                </div>
                                <div class="stat-item">
                                    <h3>${totalTime}s</h3>
                                    <p>ÂêàË®àÊôÇÈñì</p>
                                </div>
                                <div class="stat-item">
                                    <h3>${averageTime}s</h3>
                                    <p>Âπ≥ÂùáÊôÇÈñì</p>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-primary btn-large" onclick="restartPractice()">
                                üîÑ „ÇÇ„ÅÜ‰∏ÄÂ∫¶Á∑¥Áøí
                            </button>
                            <button class="btn btn-secondary" onclick="goToModeSelection()">
                                ‚Üê „É¢„Éº„ÉâÈÅ∏Êäû„Å´Êàª„Çã
                            </button>
                        </div>
                    </div>
                `;
            }

            finishPractice() {
                this.showResults();
            }

            restartPractice() {
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.selectedChoice = null;
                this.displayCurrentQuestion();
            }

            goToModeSelection() {
                document.getElementById('practiceArea').classList.remove('show');
                document.getElementById('settingsSection').classList.remove('show');
                document.getElementById('practiceModesSection').style.display = 'grid';
                
                this.stopTimer();
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                this.currentMode = null;
            }

            goBack() {
                this.goToModeSelection();
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞
        function selectMode(mode) {
            window.practiceSystem.selectMode(mode);
        }

        function startPractice() {
            window.practiceSystem.startPractice();
        }

        function selectChoice(choiceIndex) {
            window.practiceSystem.selectChoice(choiceIndex);
        }

        function submitAnswer() {
            window.practiceSystem.submitAnswer();
        }

        function nextQuestion() {
            window.practiceSystem.nextQuestion();
        }

        function finishPractice() {
            window.practiceSystem.finishPractice();
        }

        function restartPractice() {
            window.practiceSystem.restartPractice();
        }

        function goToModeSelection() {
            window.practiceSystem.goToModeSelection();
        }

        function goBack() {
            window.practiceSystem.goBack();
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            window.practiceSystem = new PracticeSystem();
            
            // „Çµ„É≥„Éó„É´ÂïèÈ°å„Åå„Å™„ÅÑÂ†¥Âêà„ÅØË™≠„ÅøËæº„Åø„Éú„Çø„É≥„ÇíË°®Á§∫
            const questions = JSON.parse(localStorage.getItem('mathQuestions') || '[]');
            if (questions.length === 0) {
                const container = document.querySelector('.container');
                const sampleSection = document.createElement('div');
                sampleSection.style.cssText = 'background: white; border-radius: 12px; padding: 30px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1);';
                sampleSection.innerHTML = `
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">üìù ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                    <p style="margin-bottom: 20px;">Á∑¥Áøí„ÇíÂßã„ÇÅ„Çã„Å´„ÅØÂïèÈ°å„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ„Çµ„É≥„Éó„É´ÂïèÈ°å„ÇíË™≠„ÅøËæº„ÇÄ„Åã„ÄÅÊñ∞„Åó„ÅÑÂïèÈ°å„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    <button class="btn btn-primary" onclick="loadSampleData()">üì• „Çµ„É≥„Éó„É´ÂïèÈ°åË™≠„ÅøËæº„Åø</button>
                    <a href="../creator/" class="btn btn-secondary">‚ú® ÂïèÈ°å‰ΩúÊàê</a>
                `;
                container.insertBefore(sampleSection, document.getElementById('practiceModesSection'));
            }
        });

        function loadSampleData() {
            const sampleData = [
                {
                    id: 'math_001',
                    type: 'A1',
                    title: '‰∫åÊ¨°ÊñπÁ®ãÂºè„ÅÆËß£',
                    question: 'x¬≤ - 5x + 6 = 0 „ÅÆËß£„ÅØÔºü',
                    choices: ['x = 1, 6', 'x = 2, 3', 'x = -2, -3', 'x = -1, -6'],
                    correct: 1,
                    difficulty: '‰∏≠',
                    category: '‰ª£Êï∞',
                    explanation: 'Âõ†Êï∞ÂàÜËß£„Åô„Çã„Å® (x-2)(x-3) = 0 „Çà„Çä x = 2, 3',
                    created: new Date().toISOString(),
                    approvals: 3,
                    rating: 4.2
                },
                {
                    id: 'math_002',
                    type: 'F1',
                    title: '‰∏âËßíÈñ¢Êï∞„ÅÆÂÄ§',
                    question: 'sin 60¬∞ „ÅÆÂÄ§„ÇíÊ±Ç„ÇÅ„Å™„Åï„ÅÑ„ÄÇ',
                    answer: '‚àö3/2',
                    difficulty: 'Êòì',
                    category: '‰∏âËßíÈñ¢Êï∞',
                    explanation: 'ÁâπÂà•Ëßí„ÅÆÂÄ§„Å®„Åó„Å¶Ë¶ö„Åà„ÇãÂü∫Êú¨ÂÄ§',
                    created: new Date().toISOString(),
                    approvals: 4,
                    rating: 4.0
                },
                {
                    id: 'math_003',
                    type: 'F2',
                    title: 'Ê•µÈôê„ÅÆË®àÁÆó',
                    question: 'lim(x‚Üí0) sin x / x „ÇíÊ±Ç„ÇÅ„Çà„ÄÇ',
                    answer: '1',
                    difficulty: 'Èõ£',
                    category: 'ÂæÆÂàÜ',
                    explanation: '„É≠„Éî„Çø„É´„ÅÆÂÆöÁêÜ„Çí‰ΩøÁî®„Åô„Çã„Åã„ÄÅÊ®ôÊ∫ñÁöÑ„Å™Ê•µÈôê„Å®„Åó„Å¶Áü•„Çâ„Çå„Å¶„ÅÑ„ÇãÂÄ§',
                    created: new Date().toISOString(),
                    approvals: 5,
                    rating: 3.8
                },
                {
                    id: 'math_004',
                    type: 'A1',
                    title: 'Á¢∫Áéá„ÅÆÂü∫Êú¨',
                    question: '„Ç≥„Ç§„É≥„Çí3ÂõûÊäï„Åí„Å¶„ÄÅ„Åô„Åπ„Å¶Ë°®„ÅåÂá∫„ÇãÁ¢∫Áéá„ÅØÔºü',
                    choices: ['1/2', '1/4', '1/8', '1/16'],
                    correct: 2,
                    difficulty: 'Êòì',
                    category: 'Á¢∫Áéá',
                    explanation: '(1/2)¬≥ = 1/8',
                    created: new Date().toISOString(),
                    approvals: 3,
                    rating: 4.5
                },
                {
                    id: 'math_005',
                    type: 'F1',
                    title: 'ÂæÆÂàÜ„ÅÆË®àÁÆó',
                    question: 'f(x) = x¬≥ + 2x¬≤ - x + 1 „ÅÆÂ∞éÈñ¢Êï∞„ÇíÊ±Ç„ÇÅ„Å™„Åï„ÅÑ„ÄÇ',
                    answer: 'f\'(x) = 3x¬≤ + 4x - 1',
                    difficulty: '‰∏≠',
                    category: 'ÂæÆÂàÜ',
                    explanation: 'ÂêÑÈ†Ö„Çí„Åπ„Åç‰πó„ÅÆÂÖ¨Âºè„ÅßÂæÆÂàÜ„Åô„Çã',
                    created: new Date().toISOString(),
                    approvals: 4,
                    rating: 4.1
                }
            ];

            localStorage.setItem('mathQuestions', JSON.stringify(sampleData));
            location.reload();
        }
    </script>
</body>
</html>