<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>要約問題管理システム - Questa Manager</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="../../manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="要約管理">
    <link rel="apple-touch-icon" href="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-TileImage" content="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="英語要約問題の作成・編集・管理システム。オフライン対応PWAアプリ。">
    <meta name="keywords" content="英語,要約,問題作成,管理,PWA,オフライン">
    <meta name="author" content="Questa Manager">
    
    <!-- Open Graph -->
    <meta property="og:title" content="要約問題管理システム">
    <meta property="og:description" content="英語要約問題の作成・編集・管理">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://pub-d59d6e46c3154423956f648f8df909ae.r2.dev/61203.jpg">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #4f46e5;
            --accent-color: #818cf8;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            
            /* モジュールカラー */
            --voca-color: #10b981;
            --grammar-color: #f59e0b;
            --reading-color: #8b5cf6;
            --listening-color: #ef4444;
            --summary-color: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: var(--hover-bg);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .module-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--module-color), var(--accent-color));
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .module-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .module-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .module-description {
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .module-stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .module-stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--module-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
        }

        .module-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .module-features li {
            padding: 5px 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .module-features li:before {
            content: "✓ ";
            color: var(--module-color);
            font-weight: bold;
        }

        .module-card.voca { --module-color: var(--voca-color); }
        .module-card.grammar { --module-color: var(--grammar-color); }
        .module-card.reading { --module-color: var(--reading-color); }
        .module-card.listening { --module-color: var(--listening-color); }
        .module-card.summary { --module-color: var(--summary-color); }

        .overview-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .overview-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .overview-card {
            text-align: center;
            padding: 30px;
            background: var(--bg-color);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .overview-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .overview-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .overview-label {
            color: #64748b;
            font-size: 1.1rem;
        }

        .tools-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .tools-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .tool-card {
            background: var(--bg-color);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .tool-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .tool-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .tool-description {
            font-size: 0.9rem;
            color: #64748b;
        }

        .recent-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .recent-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }

        .recent-questions {
            display: grid;
            gap: 20px;
        }

        .recent-question {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-info h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .question-meta {
            font-size: 0.875rem;
            color: #64748b;
        }

        .question-type {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
        }

        .type-voca { background: var(--voca-color); }
        .type-grammar { background: var(--grammar-color); }
        .type-reading { background: var(--reading-color); }
        .type-listening { background: var(--listening-color); }
        .type-summary { background: var(--summary-color); }

        .footer {
            text-align: center;
            margin-top: 60px;
            color: #64748b;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .overview-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tools-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>統合英語問題管理システム</h1>
            <p>あらゆるタイプの英語問題を作成・管理する総合プラットフォーム</p>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('overview')">
                📊 概要
            </div>
            <div class="nav-tab" onclick="showTab('modules')">
                📚 モジュール
            </div>
            <div class="nav-tab" onclick="showTab('tools')">
                🛠️ ツール
            </div>
            <div class="nav-tab" onclick="showTab('recent')">
                📝 最近の問題
            </div>
        </div>

        <div id="overview" class="tab-content active">
            <div class="overview-section">
                <h2 class="overview-title">システム概要</h2>
                <div class="overview-grid">
                    <div class="overview-card">
                        <div class="overview-icon">📝</div>
                        <div class="overview-number" id="totalQuestions">0</div>
                        <div class="overview-label">総問題数</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">🎯</div>
                        <div class="overview-number">5</div>
                        <div class="overview-label">専門モジュール</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">📋</div>
                        <div class="overview-number">15+</div>
                        <div class="overview-label">問題形式</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon">💾</div>
                        <div class="overview-number">✓</div>
                        <div class="overview-label">ローカル保存</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="modules" class="tab-content">
            <div class="modules-grid">
                <a href="../voca/" class="module-card voca">
                    <div class="module-icon">📚</div>
                    <h2 class="module-title">語彙問題</h2>
                    <p class="module-description">単語や語彙に関する問題を作成・管理します</p>
                    <ul class="module-features">
                        <li>意味選択問題</li>
                        <li>空所補充問題</li>
                        <li>複数選択肢対応</li>
                        <li>難易度設定</li>
                    </ul>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="stat-number" id="vocaCount">0</div>
                            <div class="stat-label">問題数</div>
                        </div>
                        <div class="module-stat">
                            <div class="stat-number">2</div>
                            <div class="stat-label">形式</div>
                        </div>
                    </div>
                </a>

                <a href="../grammar/" class="module-card grammar">
                    <div class="module-icon">📝</div>
                    <h2 class="module-title">文法問題</h2>
                    <p class="module-description">文法や構文に関する問題を作成・管理します</p>
                    <ul class="module-features">
                        <li>下線部選択問題</li>
                        <li>語順並べ替え問題</li>
                        <li>4択・5択問題</li>
                        <li>多彩な問題形式</li>
                    </ul>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="stat-number" id="grammarCount">0</div>
                            <div class="stat-label">問題数</div>
                        </div>
                        <div class="module-stat">
                            <div class="stat-number">4</div>
                            <div class="stat-label">形式</div>
                        </div>
                    </div>
                </a>

                <a href="../reading/" class="module-card reading">
                    <div class="module-icon">📖</div>
                    <h2 class="module-title">読解問題</h2>
                    <p class="module-description">長文読解や文章理解に関する問題を作成・管理します</p>
                    <ul class="module-features">
                        <li>複数設問対応</li>
                        <li>多様な読解形式</li>
                        <li>本文と出典管理</li>
                        <li>設問番号自動生成</li>
                    </ul>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="stat-number" id="readingCount">0</div>
                            <div class="stat-label">問題数</div>
                        </div>
                        <div class="module-stat">
                            <div class="stat-number">5</div>
                            <div class="stat-label">形式</div>
                        </div>
                    </div>
                </a>

                <a href="../listening/" class="module-card listening">
                    <div class="module-icon">🎧</div>
                    <h2 class="module-title">リスニング問題</h2>
                    <p class="module-description">聴解力に関する問題を作成・管理します</p>
                    <ul class="module-features">
                        <li>音声ファイルアップロード</li>
                        <li>複数設問対応</li>
                        <li>ドラッグ＆ドロップ対応</li>
                        <li>問題セット管理</li>
                    </ul>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="stat-number" id="listeningCount">0</div>
                            <div class="stat-label">問題数</div>
                        </div>
                        <div class="module-stat">
                            <div class="stat-number">1</div>
                            <div class="stat-label">形式</div>
                        </div>
                    </div>
                </a>

                <a href="summary.html" class="module-card summary">
                    <div class="module-icon">📄</div>
                    <h2 class="module-title">要約問題</h2>
                    <p class="module-description">文章の要約スキルを評価する問題を作成・管理します</p>
                    <ul class="module-features">
                        <li>複数の要約長さ対応</li>
                        <li>評価基準設定</li>
                        <li>模範解答管理</li>
                        <li>ジャンル分類</li>
                    </ul>
                    <div class="module-stats">
                        <div class="module-stat">
                            <div class="stat-number" id="summaryCount">0</div>
                            <div class="stat-label">問題数</div>
                        </div>
                        <div class="module-stat">
                            <div class="stat-number">6</div>
                            <div class="stat-label">ジャンル</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <div id="tools" class="tab-content">
            <div class="tools-section">
                <h2 class="tools-title">便利ツール</h2>
                <div class="tools-grid">
                    <div class="tool-card" onclick="exportData()">
                        <div class="tool-icon">📤</div>
                        <div class="tool-name">データエクスポート</div>
                        <div class="tool-description">すべての問題データをJSON形式でエクスポート</div>
                    </div>
                    <div class="tool-card" onclick="importData()">
                        <div class="tool-icon">📥</div>
                        <div class="tool-name">データインポート</div>
                        <div class="tool-description">JSONファイルから問題データをインポート</div>
                    </div>
                    <div class="tool-card" onclick="clearAllData()">
                        <div class="tool-icon">🗑️</div>
                        <div class="tool-name">データ消去</div>
                        <div class="tool-description">すべての問題データを消去</div>
                    </div>
                    <div class="tool-card" onclick="generateReport()">
                        <div class="tool-icon">📊</div>
                        <div class="tool-name">レポート生成</div>
                        <div class="tool-description">問題の統計レポートを生成</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="recent" class="tab-content">
            <div class="recent-section">
                <h2 class="recent-title">最近の問題</h2>
                <div class="recent-questions" id="recentQuestions">
                    <!-- 最近の問題がここに表示されます -->
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2024 統合英語問題管理システム. All rights reserved.</p>
        </div>
    </div>

    <script>
        // タブ切り替え
        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // 統計情報の更新
        function updateStats() {
            const modules = [
                { name: 'vocab', id: 'vocaCount' },
                { name: 'grammar', id: 'grammarCount' },
                { name: 'reading', id: 'readingCount' },
                { name: 'listening', id: 'listeningCount' },
                { name: 'summary', id: 'summaryCount' }
            ];
            
            let totalQuestions = 0;
            
            modules.forEach(module => {
                const questions = JSON.parse(localStorage.getItem(module.name + 'Questions') || '[]');
                const count = questions.length;
                document.getElementById(module.id).textContent = count;
                totalQuestions += count;
            });
            
            document.getElementById('totalQuestions').textContent = totalQuestions;
        }

        // 最近の問題を取得
        function getRecentQuestions() {
            const modules = ['vocab', 'grammar', 'reading', 'listening', 'summary'];
            let allQuestions = [];
            
            modules.forEach(moduleName => {
                const questions = JSON.parse(localStorage.getItem(moduleName + 'Questions') || '[]');
                questions.forEach(question => {
                    allQuestions.push({
                        ...question,
                        module: moduleName,
                        createdAt: new Date(question.createdAt)
                    });
                });
            });
            
            // 作成日でソートして最新10件を取得
            allQuestions.sort((a, b) => b.createdAt - a.createdAt);
            return allQuestions.slice(0, 10);
        }

        // 最近の問題を表示
        function displayRecentQuestions() {
            const container = document.getElementById('recentQuestions');
            const recentQuestions = getRecentQuestions();
            
            if (recentQuestions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #64748b;">問題がありません</p>';
                return;
            }
            
            container.innerHTML = recentQuestions.map(question => {
                const typeNames = {
                    'vocab': '語彙',
                    'grammar': '文法',
                    'reading': '読解',
                    'listening': 'リスニング',
                    'summary': '要約'
                };
                
                let title = '無題';
                if (question.module === 'vocab') {
                    title = question.word || question.sentence || '無題';
                } else if (question.module === 'grammar') {
                    title = question.sentence || question.question || '無題';
                } else if (question.module === 'reading') {
                    title = question.title || '無題';
                } else if (question.module === 'listening') {
                    title = question.setTitle || '無題';
                } else if (question.module === 'summary') {
                    title = question.title || '無題';
                }
                
                return `
                    <div class="recent-question">
                        <div class="question-info">
                            <h4>${title}</h4>
                            <div class="question-meta">
                                ${typeNames[question.module]} • 
                                難易度: ${question.difficulty} • 
                                ${question.createdAt.toLocaleDateString()}
                            </div>
                        </div>
                        <div class="question-type type-${question.module}">
                            ${typeNames[question.module]}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ツール機能
        function exportData() {
            const modules = ['vocab', 'grammar', 'reading', 'listening', 'summary'];
            const exportData = {};
            
            modules.forEach(module => {
                exportData[module] = JSON.parse(localStorage.getItem(module + 'Questions') || '[]');
            });
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `english-questions-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('データをエクスポートしました');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            Object.keys(data).forEach(module => {
                                if (Array.isArray(data[module])) {
                                    localStorage.setItem(module + 'Questions', JSON.stringify(data[module]));
                                }
                            });
                            
                            updateStats();
                            displayRecentQuestions();
                            showNotification('データをインポートしました');
                        } catch (error) {
                            showNotification('インポートに失敗しました', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('すべての問題データを消去してもよろしいですか？この操作は元に戻せません。')) {
                const modules = ['vocab', 'grammar', 'reading', 'listening', 'summary'];
                modules.forEach(module => {
                    localStorage.removeItem(module + 'Questions');
                });
                
                updateStats();
                displayRecentQuestions();
                showNotification('すべてのデータを消去しました');
            }
        }

        function generateReport() {
            const modules = ['vocab', 'grammar', 'reading', 'listening', 'summary'];
            let report = '英語問題管理システム 統計レポート\n';
            report += '=====================================\n\n';
            report += `生成日時: ${new Date().toLocaleString()}\n\n`;
            
            let totalQuestions = 0;
            modules.forEach(module => {
                const questions = JSON.parse(localStorage.getItem(module + 'Questions') || '[]');
                const count = questions.length;
                totalQuestions += count;
                
                const typeNames = {
                    'vocab': '語彙',
                    'grammar': '文法',
                    'reading': '読解',
                    'listening': 'リスニング',
                    'summary': '要約'
                };
                
                report += `${typeNames[module]}問題: ${count}件\n`;
                
                if (count > 0) {
                    const avgDifficulty = questions.reduce((sum, q) => sum + q.difficulty, 0) / count;
                    report += `  平均難易度: ${avgDifficulty.toFixed(1)}\n`;
                    
                    const difficulties = [0, 0, 0, 0, 0];
                    questions.forEach(q => {
                        difficulties[q.difficulty - 1]++;
                    });
                    report += `  難易度分布: Lev1(${difficulties[0]}) Lev2(${difficulties[1]}) Lev3(${difficulties[2]}) Lev4(${difficulties[3]}) Lev5(${difficulties[4]})\n`;
                }
                report += '\n';
            });
            
            report += `総問題数: ${totalQuestions}件\n`;
            
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `english-questions-report-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('レポートを生成しました');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? 'var(--primary-color)' : '#ef4444'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ページ読み時に初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            displayRecentQuestions();
        });
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('../../sw.js')
                    .then(function(registration) {
                        console.log('PWA: Service Worker登録成功', registration.scope);
                        
                        // PWAインストール促進バナー
                        let deferredPrompt;
                        window.addEventListener('beforeinstallprompt', (e) => {
                            e.preventDefault();
                            deferredPrompt = e;
                            
                            // インストールバナーを表示
                            const installBanner = document.createElement('div');
                            installBanner.innerHTML = `
                                <div style="
                                    position: fixed; 
                                    bottom: 20px; 
                                    left: 50%; 
                                    transform: translateX(-50%);
                                    background: var(--primary-color); 
                                    color: white; 
                                    padding: 15px 20px; 
                                    border-radius: 25px; 
                                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                                    z-index: 1000;
                                    font-size: 14px;
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    max-width: 90vw;
                                ">
                                    📱 このアプリをホーム画面に追加
                                    <button onclick="installPWA()" style="
                                        background: white; 
                                        color: var(--primary-color); 
                                        border: none; 
                                        padding: 8px 15px; 
                                        border-radius: 20px; 
                                        cursor: pointer;
                                        font-weight: bold;
                                    ">追加</button>
                                    <button onclick="this.parentElement.parentElement.remove()" style="
                                        background: none; 
                                        color: white; 
                                        border: 1px solid white; 
                                        padding: 8px 15px; 
                                        border-radius: 20px; 
                                        cursor: pointer;
                                    ">後で</button>
                                </div>
                            `;
                            document.body.appendChild(installBanner);
                            
                            // インストール実行関数をグローバルに
                            window.installPWA = () => {
                                deferredPrompt.prompt();
                                deferredPrompt.userChoice.then((choiceResult) => {
                                    if (choiceResult.outcome === 'accepted') {
                                        console.log('PWA: ユーザーがインストールを受け入れました');
                                    }
                                    deferredPrompt = null;
                                    installBanner.remove();
                                });
                            };
                        });
                    })
                    .catch(function(error) {
                        console.log('PWA: Service Worker登録失敗', error);
                    });
            });
        }
    </script>
</body>
</html>